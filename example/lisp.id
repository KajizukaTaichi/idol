import stdlib.id;

func ( lisp program ) {
    let evaled = [];
    for atom in program {
        if ({ type of atom } == "list") {
            let evaled = evaled + { lisp atom };
        } else {
            let evaled = evaled + atom;
        }
    };
    let program = evaled;

    if (program :: 0 == "+") {
        let result = program :: 1;
        for i in { slice program { range 2 { len program } 1 } } {
            let result = result + i;
        };
        (result)
    } else {
        if (program :: 0 == "-") {
            let result = program :: 1;
            for i in { slice program { range 2 { len program } 1 } } {
                let result = result - i;
            };
            (result)
        } else {
            if (program :: 0 == "*") {
                let result = program :: 1;
                for i in { slice program { range 2 { len program } 1 } } {
                    let result = result * i ;
                };
                (result)
            } else {
                if (program :: 0 == "/") {
                    let result = program :: 1;
                    for i in { slice program { range 2 { len program } 1 } } {
                        let result = result / i ;
                    };
                    (result)
                } else {
                    fault
                }
            }
        }
    }
};

let s-expr = [
    "+", ["/", 9, 3],
    ["*", 9, ["-", 12, 3]],
    ["*", 2, 4], 8
];
puts { lisp s-expr };
